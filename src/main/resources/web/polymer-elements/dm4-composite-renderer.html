<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="dm4-topic-renderer.html">
<link rel="import" href="dm4-multi-renderer.html">

<dom-module id="dm4-composite-renderer">

    <template>
        <div>Composite</div>
        <template is="dom-repeat" items="{{_getAssocDefs(topic)}}">
            <template is="dom-if" if="{{_isOne(item)}}" restamp>
                <div>ONE</div>
                <dm4-topic-renderer topic="{{_getChildTopic(topic, item)}}"></dm4-topic-renderer>
            </template>
            <template is="dom-if" if="{{_isMany(item)}}" restamp>
                <div>MANY</div>
                <dm4-multi-renderer topics="{{_getChildTopics(topic, item)}}"></dm4-multi-renderer>
            </template>
        </template>
    </template>

    <script>
        Polymer({
            is: "dm4-composite-renderer",

            _getAssocDefs: function(topic) {
                console.log("_getAssocDefs", topic);
                return topic ? this._getTopicType(topic.type_uri).assocDefs : [];
            },

            _getChildTopic: function(topic, assocDef) {
                console.log("_getChildTopic", topic, assocDef);
                return topic.childs[assocDef.childTypeUri];
            },

            _getChildTopics: function(topic, assocDef) {
                console.log("_getChildTopics", topic, assocDef);
                return topic.childs[assocDef.childTypeUri];
            },

            _isOne: function(assocDef) {
                console.log("_isOne", assocDef);
                return assocDef.child_cardinality_uri == "dm4.core.one";
            },

            _isMany: function(assocDef) {
                console.log("_isMany", assocDef);
                return assocDef.child_cardinality_uri == "dm4.core.many";
            },

            _getTopicType: function(typeUri) {
                return document.createElement("iron-meta").byKey("topicTypes")[typeUri];
            }
        });
    </script>

</dom-module>
