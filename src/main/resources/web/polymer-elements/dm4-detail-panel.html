<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="dm4-topic-renderer.html">

<dom-module id="dm4-detail-panel">

    <style>
        :host {
            flex: 0 0 25em;
            padding: 1em;
            overflow: auto;
            background-color: #f8f8f8;
        }
    </style>

    <template>
        <iron-ajax id="getTopic" url="{{_getURL(topicId)}}" params='{"include_childs": true}'
            content-type="application/json" last-response="{{topic}}">
        </iron-ajax>

        <h2>{{topic.value}}</h2>
        <dm4-topic-renderer topic="{{topic}}" form-mode="{{formMode}}"></dm4-topic-renderer>
    </template>

    <script>
        Polymer({
            is: "dm4-detail-panel",

            properties: {

                /**
                 * ID of the displayed topic.
                 * Once changed a new topic is loaded and displayed.
                 */
                topicId: {
                    type: Number,
                    observer: "_topicIdChanged"
                },

                /**
                 * The displayed topic.
                 */
                topic: {
                    type: Object
                },

                /**
                 * If `true` a form for the displayed topic is rendered.
                 */
                formMode: {
                    type: Boolean,
                    value: false
                }
            },

            showForm: function(topic) {
                this.topic = null;
                //
                this.formMode = true;
                this.topic = topic;
            },

            _topicIdChanged: function() {
                this.topic = null;      // empty detail panel before refilling it
                this.$.getTopic.generateRequest();
            },

            _getURL: function(topicId) {
                return "http://localhost:8080/core/topic/" + topicId;
            }
        });
    </script>

</dom-module>
