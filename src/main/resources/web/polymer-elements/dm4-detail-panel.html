<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="dm4-topic-renderer.html">

<dom-module id="dm4-detail-panel">

    <style>
        :host {
            flex: 0 0 25em;
            background-color: lightgray;
        }
    </style>

    <template>
        <iron-ajax id="getTopic" url="{{_getURL(topicId)}}" params='{"include_childs": true}'
            content-type="application/json" last-response="{{topic}}">
        </iron-ajax>

        <h2>{{topic.value}}<h2>
        <h3>{{_getTypeName(topic)}}</h3>

        <dm4-topic-renderer topic="{{topic}}"></dm4-topic-renderer>
    </template>

    <script>
        Polymer({
            is: "dm4-detail-panel",

            properties: {
                topicId: {
                    type: Number,
                    observer: "_topicIdChanged"
                }
            },

            _topicIdChanged: function() {
                this.$.getTopic.generateRequest();
            },

            _getURL: function(topicId) {
                return "http://localhost:8080/core/topic/" + topicId;
            },

            _getTypeName: function(topic) {
                return this._getTopicType(topic.type_uri).value;
            },

            _getTopicType: function(typeUri) {
                return document.createElement("iron-meta").byKey("topicTypes")[typeUri];
            }
        });
    </script>

</dom-module>
