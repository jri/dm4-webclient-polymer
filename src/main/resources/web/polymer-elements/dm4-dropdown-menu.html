<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="dm4-menu-overlay.html">

<dom-module id="dm4-dropdown-menu">

    <style>
        paper-button[active] {
            background-color: rgba(0, 0, 0, 0.25);
        }
    </style>

    <template>
        <!-- Note: with Firefox the paper-button "noink" attribute causes constant high CPU load
        once the button is pressed -->
        <paper-button id="button" on-tap="_openMenu" toggles raised>{{label}}</paper-button>
        <dm4-menu-overlay id="menu">
            <content></content>
        </dm4-menu-overlay>
    </template>

    <script>
        Polymer({
            is: "dm4-dropdown-menu",

            properties: {

                /**
                 * The label displayed on the button.
                 */
                label: {
                    type: String
                }
            },

            listeners: {
                "iron-overlay-closed": "_deactivateButton"
            },

            // --------------------------------------------------------------------------------------------- Private API

            _openMenu: function(e) {
                // console.log("_openMenu", this.$.button.active);
                if (this.$.button.active) {
                    var buttonRect = this.$.button.getBoundingClientRect();
                    this.$.menu.open();     // menu must opened *before* being styled
                    this.$.menu.style.left = buttonRect.left   + "px";
                    this.$.menu.style.top  = buttonRect.bottom + "px";
                }
            },

            _deactivateButton: function(e) {
                // console.log("_deactivateButton", e);
                this.$.button.active = false;
            }
        });
    </script>

</dom-module>
