<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">

<dom-module id="dm4-dropdown-menu">

    <style>
        paper-button[active] {
            background-color: rgba(0, 0, 0, 0.25);
        }
        paper-menu {
            display: none;
            position: absolute;
            border: 1px solid lightgray;
            overflow: auto;
            box-sizing: border-box;
        }
    </style>

    <template>
        <!-- Note: with Firefox the paper-button "noink" attribute causes constant high CPU load
        once the button is pressed -->
        <paper-button id="button" on-tap="_buttonTap" toggles raised>{{label}}</paper-button>
        <paper-menu id="menu" on-iron-select="_itemSelect">
            <content></content>
        </paper-menu>
    </template>

    <script>
        Polymer({
            is: "dm4-dropdown-menu",

            _buttonTap: function(e) {
                if (this.$.button.active) {
                    this._showMenu();
                    // adjust menu position and height
                    this.$.menu.style.left = this.$.button.getBoundingClientRect().left + "px";
                    this.$.menu.style["max-height"] = document.body.getBoundingClientRect().height -
                                                        this.$.menu.getBoundingClientRect().top + "px";
                } else {
                    this._hideMenu();
                }
            },

            _itemSelect: function() {
                this.$.button.active = false;
                this._hideMenu();
            },

            _showMenu: function() {
                this.$.menu.style.display = "block";
            },

            _hideMenu: function() {
                this.$.menu.style.display = "none";
            }
        });
    </script>

</dom-module>
