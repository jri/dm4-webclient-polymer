<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="dm4-canvas-renderer.html">

<dom-module id="dm4-topicmap-panel">

    <style>
        :host {
            flex: auto;
            position: relative;
            overflow: hidden;
            background-color: lightyellow;
        }
    </style>

    <template>
        <iron-ajax id="getTopicmap" url="{{_getURL(topicmapId)}}"
            headers='{"Content-Type": "application/json", "Accept": "application/json"}' last-response="{{topicmap}}">
        </iron-ajax>
        <dm4-canvas-renderer topicmap={{topicmap}} size="{{size}}">
        </dm4-canvas-renderer>
    </template>

    <script>
        Polymer({
            is: "dm4-topicmap-panel",

            properties: {
                topicmapId: {
                    type: Number,
                    observer: "_topicmapIdChanged"
                }
            },

            behaviors: [
                Polymer.IronResizableBehavior
            ],

            listeners: {
                "iron-resize": "_panelResized"
            },

            _topicmapIdChanged: function() {
                this.$.getTopicmap.generateRequest();
            },

            _panelResized: function(e) {
                this.size = {
                    width: this.clientWidth,
                    height: this.clientHeight
                }
            },

            _getURL: function(topicmapId) {
                return "http://localhost:8080/topicmap/" + topicmapId
            }
        });
    </script>

</dom-module>
