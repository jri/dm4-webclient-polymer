<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="dm4-canvas-renderer.html">

<dom-module id="dm4-topicmap-panel">

    <style>
        :host {
            flex: auto;
            position: relative;
            overflow: hidden;
            background-color: #fff;
        }
    </style>

    <template>
        <dm4-canvas-renderer topicmap="[[topicmap]]" size="[[size]]" dm4="[[dm4]]">
        </dm4-canvas-renderer>
    </template>

    <script>
        Polymer({
            is: "dm4-topicmap-panel",

            properties: {

                /**
                 * The displayed topicmap.
                 */
                topicmap: {
                    type: Object
                },

                /**
                 * The current size of this topicmap panel.
                 */
                size: {
                    type: Object
                },

                /**
                 * Global state.
                 * See `dm4-webclient`.
                 */
                dm4: {
                    type: Object
                }
            },

            behaviors: [
                Polymer.IronResizableBehavior
            ],

            listeners: {
                "iron-resize": "_panelResized"
            },

            // ---------------------------------------------------------------------------------------------- Public API

            showTopic: function(topic, select) {
                topic.view_props = {
                    "dm4.topicmaps.x": this.size.width  * Math.random(),
                    "dm4.topicmaps.y": this.size.height * Math.random(),
                    "dm4.topicmaps.visibility": true
                };
                // console.log("showTopic", topic);
                this.push("topicmap.topics", topic);
                //
                if (select) {
                    this.setSelectedTopic(topic.id);
                }
            },

            setSelectedTopic: function(topicId) {
                this.set("dm4.selectedTopicIds", [topicId]);
            },

            showTopicmap: function(topicmap) {
                this.topicmap = topicmap;
            },

            // --------------------------------------------------------------------------------------------- Private API

            _panelResized: function(e) {
                this.size = {
                    width: this.clientWidth,
                    height: this.clientHeight
                }
            }
        });
    </script>

</dom-module>
