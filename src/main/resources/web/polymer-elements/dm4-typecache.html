<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-meta/iron-meta.html">

<dom-module id="dm4-typecache">

    <template>
        <iron-meta key="topicTypes" value="{{topicTypes}}"></iron-meta>
        <iron-meta key="assocTypes" value="{{assocTypes}}"></iron-meta>

        <iron-ajax auto url="http://localhost:8080/core/topictype/all" content-type="application/json"
            last-response="{{typeDefs.topicTypes}}">
        </iron-ajax>
        <iron-ajax auto url="http://localhost:8080/core/assoctype/all" content-type="application/json"
            last-response="{{typeDefs.assocTypes}}">
        </iron-ajax>
    </template>

    <script>
        Polymer({
            is: "dm4-typecache",

            properties:  {
                typeDefs: {     // intermediate
                    type: Object,
                    value: {
                        topicTypes: [],
                        assocTypes: []
                    }
                },
                topicTypes: {
                    type: Object,
                    value: {}
                },
                assocTypes: {
                    type: Object,
                    value: {}
                }
            },

            observers: [
                "_hashTopicTypes(typeDefs.topicTypes)",
                "_hashAssocTypes(typeDefs.assocTypes)"
            ],

            // --- Helper ---

            _hashTopicTypes: function(topicTypes) {
                // console.log("_hashTopicTypes", topicTypes);
                this._hash(topicTypes, this.topicTypes, DM4.TopicType);
            },

            _hashAssocTypes: function(assocTypes) {
                // console.log("_hashAssocTypes", assocTypes);
                this._hash(assocTypes, this.assocTypes, DM4.AssociationType);
            },

            _hash: function(array, object, constructor) {
                for (var i = 0, item; item = array[i]; i++) {
                    object[item.uri] = new constructor(item);
                }
            }
        });
    </script>

</dom-module>
