<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="dm4-typecache">

    <template>
        <iron-ajax auto url="http://localhost:8080/core/topictype/all" content-type="application/json"
            last-response="{{dm4.topicTypesArray}}">
        </iron-ajax>
        <iron-ajax auto url="http://localhost:8080/core/assoctype/all" content-type="application/json"
            last-response="{{dm4.assocTypesArray}}">
        </iron-ajax>
    </template>

    <script>
        Polymer({
            is: "dm4-typecache",

            observers: [
                "_hashTopicTypes(dm4.topicTypesArray)",
                "_hashAssocTypes(dm4.assocTypesArray)"
            ],

            // --- Helper ---

            _hashTopicTypes: function(topicTypesArray) {
                // console.log("_hashTopicTypes", topicTypesArray);
                this._hash(topicTypesArray, this.dm4.topicTypes, DM4.TopicType);
            },

            _hashAssocTypes: function(assocTypesArray) {
                // console.log("_hashAssocTypes", assocTypesArray);
                this._hash(assocTypesArray, this.dm4.assocTypes, DM4.AssociationType);
            },

            _hash: function(array, object, constructor) {
                for (var i = 0, item; item = array[i]; i++) {
                    object[item.uri] = new constructor(item);
                }
            }
        });
    </script>

</dom-module>
